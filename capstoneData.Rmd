---
title: "National Air Quality and Its Affects on Adult Asthma, A Time Series Analysis"
name: "Rebecca Madsen"
class: "DATA 470"
output: html_notebook
---

## Abstract

Air quality and asthma, among other respiratory illnesses, are a continued struggle for many communities. In addition, the continued growth of the national and global population warrants our nation's pollution to continue to increase. This, in turn, will give to a worsening in respiratory conditions and an increase of respiratory troubles, such as asthma. Using data provided by the CDC National Environmental Public Health Tracking Network Query Tool, statistical analysis was used to see if there is a relationship between the average number of days above PM2.5 standard levels nationally and the percent of adults diagnosed with asthma who report they currently have asthma nationally through the period of 2011 to 2016. The variables were looked at both individually and against each other with the period established using the statistical tool R. Basic statistical analysis and time series modeling were used as a way of testing for a relationship between air quality and asthma. 

### Introduction of project

My goal of this time series analysis is to explore if there is any correlation between numerical percentage of national average PM2.5 levels and the numerical percentage of national adults currently reporting asthma between the years 2011 to 2016.

```{r}
library(mosaic)
library(broom)
library(tidyverse)
library(openintro)
library(Stat2Data)
library(car)
library(lme4)


library(readr)
asthma_pmlevel <- read_csv("asthmaAndPMLevelCombined.csv")
View(asthma_pmlevel)
```


Since I am using time series analysis, I will need to upload and run a few packages to make this analysis possible. CRAN gives us a huge set of public packages, and happens to have some great packages that can be used in time series analysis. Since R already has basic time series installed because of CRAN, we will be using those to explore the data between the years of 2011 to 2016. I also added the `lme4` library for multi-level analysis if possibly needed.

## Exploring the dataset

Below I am using some basic R codes to explore the dataset.

```{r}
str(asthma_pmlevel)
```

Above is general structure information about the data I am going to explore for my time series analysis of adult asthma and air quality. Next, I ran the summary statistics of the dataset for each variable (as seen below). However, the three variables I want to focus on are `Year`, `Asthma`, and `AvgPM2.5` for this analysis. 

```{r}
summary(asthma_pmlevel)
```

## Beginning Time Series Analysis

First, I want to see if there is any association between the variables `Asthma` and `AvgPM2.5` separately with time between 2011 to 2016. 

```{r}
adult_asthma <- ts(asthma_pmlevel$Asthma, start= 2011, end= 2016, frequency= 1)
plot(adult_asthma)

average_pm <- ts(asthma_pmlevel$AvgPM2.5, start = 2011, end = 2016, frequency = 1)
plot(average_pm)
```
Above we are looking at two trend lines: the percent of adults with asthma and the average days of PM2.5 levels above standard separately against time. 

* Starting with the `adult_asthma` plot, we see a positive trend across time that tells us the numerical percentage of adults with currently reported increased from 2011 to 2016.

* Next, looking at `average_pm` we see a decrease in numerical percentage of days above national levels for PM2.5 particles from 2011 to 2012, then a plateau between 2012 to 2014, then a sharp increase from 2014 to 2016.

## More in-depth time series analysis


### Looking at asthma_pmlevel with states

```{r}
per_state <- ggplot(asthma_pmlevel, aes(y = AvgPM2.5, x = Asthma, color = State)) +
                geom_point() +
              geom_smooth(method = "lm")
per_state
```
This is a mess, and isn't helpful unless I wanted to see a trend for a specific state. That is not the focus of my project, but I did want to see if there was an averaged change at state levels. (for fun) It is too hard to tell, so I will ignore the findings of this graphic.

## More time series looking at Adult Asthma and Average PM2.5 days

Below I am using the `HoltWinters()` function to fit an exponential model to the variables `average_pm` and `adult_asthma` separately.

```{r}
fit_pm <- HoltWinters(average_pm, gamma=FALSE)
plot(fit_pm)

fit_asthma <- HoltWinters(adult_asthma, gamma = FALSE)
plot(fit_asthma)
```

Using time series analysis, we also should look at creating lag. A lag of time series is created when any given number of periods in time are shifted. This is because the state of a period back in the time-line could still be affecting the current state of the time series. This will allow us to see if an earlier year is affecting a later year in our time series.

Below, I am looking at an autocorrelation for both `average_pm` and `adult_asthma` separately. The autocorrelation is looking at lag in itself for each variable to check for any correlation. Since both time series fall to 0 fairly quickly, we can assume that they are both stationary time series respectfully.

```{r}
acfRes_pm <- acf(average_pm)
acfRes_asthma <- acf(adult_asthma)
```

Next, I am looking at cross-correlation between both `adult_asthma` and `average_pm` series at once, to see if there is any causal relationship between the two time series variables.

```{r}
ccfRes <- ccf(adult_asthma, average_pm, ylab = "cross-correlation")
```


